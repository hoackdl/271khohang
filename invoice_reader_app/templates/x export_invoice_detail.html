{% extends "base.html" %}
{% load humanize %}

{% block content %}
<div class="container mt-3">

<h4 class="mb-3">üßæ <b>CHI TI·∫æT FILE XU·∫§T H√ìA ƒê∆†N</b></h4>

<div class="mb-3">
    <b>Tr·∫°ng th√°i:</b>
    {% if invoice.trang_thai == "CHO_XUAT" %}
        <span class="badge bg-warning text-dark ms-2">
            ‚è≥ Ch·ªù xu·∫•t ho√° ƒë∆°n
        </span>
    {% else %}
        <span class="badge bg-success ms-2">
            ‚úî ƒê√£ ho√†n th√†nh
        </span>
    {% endif %}
</div>

<div class="row mb-3">
    <div class="col-md-6">
        <p><b>S·ªë Hƒê:</b> {{ invoice.id }}</p>
        <p><b>Ng√†y:</b> {{ invoice.ngay_hd|date:"d/m/Y" }}</p>
        <p><b>Kh√°ch h√†ng:</b> {{ invoice.ten_nguoi_mua }}</p>
    </div>
    <div class="col-md-6">
        <p><b>MST:</b> {{ invoice.ma_so_thue_mua }}</p>
        <p><b>ƒê·ªãa ch·ªâ:</b> {{ invoice.dia_chi_mua }}</p>
        <p><b>Email:</b> {{ invoice.email }}</p>
    </div>
</div>

<table class="table table-bordered table-sm align-middle">
    <thead class="table-light text-center">
        <tr>
            <th style="width:8%">SKU</th>
            <th>T√™n h√†ng</th>
            <th style="width:6%">ƒêVT</th>
            <th style="width:6%">SL</th>
            <th style="width:10%">ƒê∆°n gi√°</th>
            <th style="width:12%">Th√†nh ti·ªÅn</th>
            <th style="width:8%">Thu·∫ø su·∫•t</th>
            <th style="width:12%">Ti·ªÅn thu·∫ø</th>
        </tr>
    </thead>
    <tbody>
        {% for i in items %}
        <tr>
            <td>{{ i.sku }}</td>
            <td>{{ i.ten_hang }}</td>
            <td class="text-center">{{ i.dvt }}</td>
            <td class="text-end">{{ i.so_luong|floatformat:2 }}</td>
            <td class="text-end">{{ i.don_gia|intcomma }}</td>
            <td class="text-end">{{ i.thanh_tien|intcomma }}</td>
            <td class="text-end">{{ i.thue_suat }}%</td>
            <td class="text-end">{{ i.tien_thue|floatformat:0|intcomma }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="8" class="text-center text-muted">
                Kh√¥ng c√≥ d√≤ng h√†ng
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="row mt-3">
    <div class="col-md-6"></div>
    <div class="col-md-6">
        <table class="table table-borderless text-end">
    <tr>
        <th>T·ªïng ti·ªÅn h√†ng:</th>
        <td>{{ invoice.tong_tien_hang|floatformat:0|intcomma }}</td>
    </tr>
    <tr>
        <th>Thu·∫ø GTGT:</th>
        <td>{{ invoice.tong_tien_thue|floatformat:0|intcomma }}</td>
    </tr>
    <tr class="fs-5">
        <th class="text-danger">Thanh to√°n:</th>
        <td class="text-danger fw-bold">
            {{ invoice.tong_tien|floatformat:0|intcomma }}
        </td>
    </tr>
</table>

    </div>
</div>

<div class="text-end mt-4 d-flex justify-content-end gap-2">
    <button type="button"
            class="btn btn-outline-secondary px-4"
            onclick="history.back()">
        ‚¨Ö Quay l·∫°i ch·ªânh s·ª≠a
    </button>

    <a href="{% url 'export_export_invoice_excel' invoice.id %}"
       class="btn btn-success px-4">
        üì• T·∫£i Excel
    </a>
</div>
{% if invoice.trang_thai != "DA_XUAT" %}
<form method="post"
      action="{% url 'export_invoice_mark_done' invoice.id %}"
      class="d-inline">
    {% csrf_token %}
    <button class="btn btn-warning px-4"
            onclick="return confirm('X√°c nh·∫≠n ƒë√°nh d·∫•u ƒë√£ xu·∫•t ho√° ƒë∆°n?')">
        ‚úÖ ƒê√°nh d·∫•u ƒë√£ ho√†n th√†nh
    </button>
</form>
{% else %}
<span class="badge bg-success fs-6">
    ‚úî ƒê√£ xu·∫•t ho√° ƒë∆°n
</span>
{% endif %}


</div>
{% endblock %}
