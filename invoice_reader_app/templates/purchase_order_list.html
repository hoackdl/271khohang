{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block container_class %}
container-fluid p-0 full-screen-container
{% endblock %}
{% block extra_head %}
{% block navbar_title %}üì¶ Danh s√°ch Phi·∫øu nh·∫≠p{% endblock %}
<style>
/* KH√îNG CHO TRANG CU·ªòN ‚Äì CH·ªà CU·ªòN TRONG B·∫¢NG */
html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
}

/* CONTAINER TO√ÄN M√ÄN H√åNH */
.full-screen-container {
    height: calc(100vh - 70px); /* N·∫øu navbar cao 70px ‚Äì ch·ªânh l·∫°i n·∫øu c·∫ßn */
    display: flex;
    flex-direction: column;
    gap: 10px;
}

/* CARD CHI·∫æM TO√ÄN B·ªò KH√îNG GIAN */
.card {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border-radius: 8px;
}

/* CARD HEADER */
.card-header {
    padding: 10px 15px !important;
    font-size: 15px;
    font-weight: 600;
}

/* CARD BODY */
.card-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 0 !important; 
    min-height: 0;
}

/* CH·ªà TABLE CU·ªòN */
.table-container {
    flex: 1;
    min-height: 0;
    overflow-y: auto;
    overflow-x: auto;
}

/* TABLE MODERN */
.table {
    width: max-content;
    min-width: 100%;
    border-collapse: collapse;
}

/* HEADER STICKY */
.table thead th {
    position: sticky;
    top: 0;
    z-index: 20;
    background: #f0f6ff !important;
    font-weight: 600;
}

/* C·ªòT ƒê·∫¶U STICKY */
.table th:first-child,
.table td:first-child {
    position: sticky;
    left: 0;
    background: #fff;
    z-index: 30;
    font-weight: 600;
}

/* C·ª† CH·ªÆ ‚Äì G·ªåN ‚Äì D·ªÑ ƒê·ªåC */
.table th, .table td {
    padding: 13px 13px !important;
    font-size: 15px;
}

/* HOVER ƒê·∫∏P */
.table tbody tr:hover {
    background-color: #eef6ff;
}

/* R√öT G·ªåN TEXT */
.truncate-cell {
    max-width: 220px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* PAGINATION G·ªåN G√ÄNG */
.pagination .page-link {
    padding: 10px 10px;
    font-size: 13px;
}


</style>
{% endblock %}

{% block content %}

<div class="full-screen-container">


    <!-- HEADER TR√äN: B·ªô l·ªçc + pagination + n√∫t -->
    <div class="d-flex align-items-center gap-2 w-100 flex-wrap">

    <!-- TI√äU ƒê·ªÄ -->
    <h5 class="mb-0 flex-shrink-0"></h5>
        <!-- NƒÉm t√†i ch√≠nh -->
    <div class="d-flex align-items-center gap-2 flex-shrink-0">
      <span class="small text-muted">NƒÉm:</span>
      <select class="form-select form-select-sm w-auto"
              onchange="location.href=this.value">
        {% for y in year_list %}
          <option value="{% url 'set_fiscal_year' y %}"
                  {% if y == current_year %}selected{% endif %}>
            {{ y }}
          </option>
        {% endfor %}
      </select>
    </div>
    <!-- FORM T√åM KI·∫æM -->
    <form method="get" class="d-flex gap-2 flex-shrink-0 mb-0">
        <input type="text" name="invoice" class="form-control form-control-sm" placeholder="S·ªë h√≥a ƒë∆°n" value="{{ search_invoice }}">
        <input type="text" name="supplier" class="form-control form-control-sm" placeholder="Nh√† cung c·∫•p" value="{{ search_supplier }}">
        <input type="text" name="po_number" class="form-control form-control-sm" placeholder="S·ªë phi·∫øu nh·∫≠p" value="{{ search_po_number }}">
        <button class="btn btn-outline-primary btn-sm">üîç T√¨m</button>
    </form>

    <!-- N√öT -->
    <a href="{% url 'invoice_list' %}" class="btn btn-outline-secondary btn-sm flex-shrink-0">
        <i class="bi bi-file-earmark-text"></i> H√≥a ƒë∆°n
    </a>

    {% if page_obj %}
        {% include "components/pagination.html" with page_obj=page_obj query_params=query_params label=label %}
    {% endif %} 


</div>


    <!-- CARD TABLE -->
    <div class="card shadow-sm">


        <div class="card-body">

            {% if pos %}
            <div class="table-container">
                <table class="table table-hover table-bordered text-center">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>M√£ PO</th>
                            <th>S·ªë Hƒê</th>
                            <th>Nh√† cung c·∫•p</th>
                            <th>MST nh√† cung c·∫•p</th> <!-- Th√™m c·ªôt MST -->
                            <th>Ti·ªÅn h√†ng</th>
                            <th>Ti·ªÅn thu·∫ø</th>
                            <th>Thanh to√°n</th>
                            <th>Ng√†y t·∫°o</th>
                            <th>Thao t√°c</th>
                        </tr>
                    </thead>

                    <tbody>
                        {% for po in pos %}
                        <tr>
                            <td>
                                {% if page_obj %}
                                    {{ page_obj.start_index|add:forloop.counter0 }}
                                {% else %}
                                    {{ forloop.counter }}
                                {% endif %}
                                </td>


                            <td><strong>{{ po.po_number }}</strong></td>
                            <td>{{ po.invoice.so_hoa_don }}</td>
                            <td class="text-start text-wrap">{{ po.invoice.ten_dv_ban }}</td>
                            <td class="text-start text-wrap">{{ po.invoice.ma_so_thue }}</td>

                            <td class="text-end">{{ po.total_amount|floatformat:0|intcomma }}</td>
                            <td class="text-end">{{ po.total_tax|floatformat:0|intcomma }}</td>
                            <td class="text-end">{{ po.total_payment|floatformat:0|intcomma }}</td>
                            <td>{{ po.invoice.ngay_hd|date:"d/m/y" }}</td>
                            <td>
                                <a href="{% url 'purchase_order_detail' po.id %}" class="btn btn-sm btn-outline-info">üëÅ</a>
                                <a href="{% url 'edit_purchase_order' po.id %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>


                </table>
            </div>

            {% else %}
                <div class="alert alert-info m-3">Ch∆∞a c√≥ phi·∫øu nh·∫≠p n√†o.</div>
            {% endif %}
        </div>
    </div>


</div>

{% endblock %}
